<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RHF Game Store</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#020617;
  color:#fff;
}
header{
  padding:16px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
  border-bottom:1px solid #1e293b;
}
.box{
  margin:16px;
  padding:16px;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:14px;
}
.item{
  margin-bottom:16px;
  padding-bottom:16px;
  border-bottom:1px solid #1e293b;
}
img{
  width:100%;
  border-radius:12px;
}
input,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:none;
}
input{
  background:#020617;
  color:#fff;
  border:1px solid #1e293b;
}
button{
  background:#22c55e;
  font-weight:bold;
  cursor:pointer;
}
.small{
  font-size:13px;
  color:#94a3b8;
}
.warn{
  font-size:13px;
  color:#facc15;
}
.hidden{display:none}
</style>
</head>

<body>

<header>ðŸŽ® RHF Game Store</header>

<!-- LOGIN -->
<div class="box" id="loginBox">
  <h3>Login (Opsional)</h3>
  <input id="user" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">LOGIN</button>
  <p class="small">Login untuk voucher & event</p>
</div>

<!-- ITEM LIST -->
<div class="box">
  <h3>Daftar Item</h3>
  <div id="items"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ================= FIREBASE =================
firebase.initializeApp({
  apiKey: "AIzaSyAyHSaALeuwibcF22VNL_6WDlcZepcDB3A",
  databaseURL: "https://rhf-gamestore-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();
const itemRef = db.ref("items");
const userRef = db.ref("users");

// ================= STATE =================
let isLogin = false;
let currentUser = "";

// ================= FORMAT RUPIAH =================
function rupiah(x){
  return Number(x).toLocaleString("id-ID");
}

// ================= LOGIN =================
function login(){
  const u = user.value.trim();
  const p = pass.value.trim();
  if(!u || !p){ alert("Lengkapi data"); return; }

  userRef.once("value",snap=>{
    let ok=false;
    snap.forEach(s=>{
      const d=s.val();
      if(d.user===u && d.pass===p && d.status==="active"){
        ok=true;
        currentUser=u;
      }
    });

    if(ok){
      isLogin=true;
      loginBox.classList.add("hidden");
      alert("Login berhasil, fitur lengkap aktif");
      loadItems();
    }else{
      alert("Login gagal / akun nonaktif");
    }
  });
}

// ================= LOAD ITEM =================
function loadItems(){
  itemRef.on("value",snap=>{
    items.innerHTML="";
    snap.forEach(s=>{
      const d=s.val();
      const id=s.key;

      items.innerHTML+=`
        <div class="item">
          <img src="${d.img}">
          <h4>${d.name}</h4>
          <p>Harga: <b>Rp ${rupiah(d.price)}</b></p>

          ${
            isLogin ? `
              <input id="v-${id}" placeholder="Kode Voucher">
              <button onclick="pakaiVoucher('${id}',${d.price})">
                Pakai Voucher
              </button>
            ` : `
              <p class="warn">Login untuk voucher & event</p>
            `
          }

          <button onclick="beli('${d.name}',${d.price})">
            Beli Sekarang
          </button>
        </div>
      `;
    });
  });
}

// ================= BELI (SEMUA BISA) =================
function beli(nama,harga){
  const wa="6285135993982"; // GANTI NOMOR KAMU
  const text=`Saya mau beli ${nama}\nHarga: Rp ${rupiah(harga)}`;
  window.open(`https://wa.me/${wa}?text=${encodeURIComponent(text)}`);
}

// ================= VOUCHER (LOGIN SAJA) =================
function pakaiVoucher(id,harga){
  if(!isLogin){
    alert("Login dulu");
    return;
  }
  alert("Logika voucher aktif (siap dikembangkan)");
}

// LOAD AWAL
loadItems();
</script>

</body>
</html>
