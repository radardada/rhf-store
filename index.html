<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RHF Game Store</title>

<style>
body{
  background:linear-gradient(180deg,#020617,#020617);
  color:#fff;
  font-family:'Segoe UI',Arial;
  padding:16px
}
h2{margin-bottom:10px}
.box{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:20px;
  padding:18px;
  margin-bottom:22px
}
input,button{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:14px;
  border:none;
  font-size:15px
}
button{font-weight:600;cursor:pointer}
.green{background:#22c55e;color:#000}
.blue{background:#38bdf8;color:#000}
.gray{background:#334155;color:#fff}
.hidden{display:none}
small{color:#94a3b8}

/* GRID ITEM */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:16px;
}
.card{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:18px;
  overflow:hidden;
  cursor:pointer;
  transition:.25s;
}
.card:hover{
  transform:translateY(-5px);
  border-color:#38bdf8;
}
.card img{
  width:100%;
  height:150px;
  object-fit:cover;
}
.card .name{
  padding:12px;
  font-weight:600;
  text-align:center;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:99;
}
.modal-box{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:20px;
  padding:18px;
  max-width:380px;
  width:92%;
}
.modal-box img{
  width:100%;
  border-radius:16px;
  margin-bottom:12px;
}
</style>
</head>

<body>

<h2>üéÆ RHF GAME STORE</h2>

<!-- LOGIN -->
<div class="box" id="loginBox">
<h3>üîê Login User</h3>
<input id="luser" placeholder="Username">
<input id="lpass" type="password" placeholder="Password">
<button class="green" onclick="login()">LOGIN</button>

<small>
Belum punya akun?<br>
<a href="https://wa.me/6285135993982?text=DAFTAR%20AKUN%20RHF" target="_blank" style="color:#38bdf8">
Daftar via WhatsApp
</a>
</small>
</div>

<!-- EVENT -->
<div class="box hidden" id="eventBox">
<h3>üì¢ INFO & EVENT</h3>
<div id="events"></div>
</div>

<!-- VOUCHER -->
<div class="box hidden" id="voucherBox">
<h3>üéüÔ∏è Voucher</h3>
<input id="voucherInput" placeholder="Masukkan kode voucher">
<button class="blue" onclick="useVoucher()">Gunakan</button>
<small id="voucherInfo"></small>
</div>

<!-- ITEM -->
<div class="box hidden" id="itemBox">
<h3>üõí Pilih Item</h3>
<div id="items" class="grid"></div>
</div>

<!-- KONFIRMASI -->
<div class="box hidden" id="confirmBox">
<h3>‚úÖ Konfirmasi Pesanan</h3>
<div id="confirmData"></div>
<button class="green" onclick="confirmOrder()">LANJUT KE WA</button>
</div>

<!-- MODAL ITEM -->
<div class="modal hidden" id="itemModal">
  <div class="modal-box">
    <img id="mImg">
    <h3 id="mName"></h3>
    <small id="mDesc"></small><br><br>
    <b id="mPrice"></b>
    <button class="green" onclick="buyNow()">BELI</button>
    <button class="gray" onclick="closeModal()">TUTUP</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAyHSaALeuwibcF22VNL_6WDlcZepcDB3A",
  authDomain: "rhf-gamestore.firebaseapp.com",
  databaseURL: "https://rhf-gamestore-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rhf-gamestore",
  storageBucket: "rhf-gamestore.firebasestorage.app",
  messagingSenderId: "52065906934",
  appId: "1:52065906934:web:c15f0eff91cc937f787cd7"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const usersRef=db.ref("users");
const itemsRef=db.ref("items");
const vouchersRef=db.ref("vouchers");
const ordersRef=db.ref("orders");
const logsRef=db.ref("logs");
const eventsRef=db.ref("events");

let currentUser=null;
let selectedItem=null;
let activeVoucher=null;

/* LOGIN */
function login(){
  usersRef.child(luser.value).once("value",s=>{
    if(!s.exists()) return alert("User tidak ditemukan");
    const d=s.val();
    if(d.pass!==lpass.value) return alert("Password salah");
    if(d.status!=="aktif") return alert("Akun diblokir");

    currentUser=d.user;
    loginBox.classList.add("hidden");
    itemBox.classList.remove("hidden");
    voucherBox.classList.remove("hidden");
    eventBox.classList.remove("hidden");
  });
}

/* EVENT */
eventsRef.limitToLast(5).on("value",s=>{
  events.innerHTML="";
  s.forEach(c=>{
    const d=c.val();
    events.innerHTML+=`
      <div class="item">
        <b>${d.title}</b><br>
        ${d.msg}<br>
        Diskon Global: ${d.disc}%
      </div>`;
  });
});

/* ITEM */
itemsRef.on("value",s=>{
  items.innerHTML="";
  s.forEach(c=>{
    const d=c.val();
    items.innerHTML+=`
      <div class="card" onclick='openItem(${JSON.stringify(d)})'>
        <img src="${d.img}">
        <div class="name">${d.name}</div>
      </div>`;
  });
});

function openItem(d){
  selectedItem=d;
  mImg.src=d.img;
  mName.innerText=d.name;
  mDesc.innerText=d.desc || "Tidak ada deskripsi";
  mPrice.innerText="Rp "+d.price.toLocaleString("id-ID");
  itemModal.classList.remove("hidden");
}
function closeModal(){ itemModal.classList.add("hidden"); }
function buyNow(){ closeModal(); showConfirm(); }

/* VOUCHER */
function useVoucher(){
  vouchersRef.child(voucherInput.value).once("value",s=>{
    if(!s.exists()) return alert("Voucher tidak valid");
    const d=s.val();
    if(!d.active||d.used>=d.max) return alert("Voucher tidak tersedia");
    activeVoucher=d;
    voucherInfo.innerText="Diskon "+d.disc+"% aktif";
  });
}

/* KONFIRMASI */
function showConfirm(){
  let price=selectedItem.price;
  let disc=activeVoucher?activeVoucher.disc:0;
  let total=Math.floor(price-(price*disc/100));

  confirmData.innerHTML=`
  Item: ${selectedItem.name}<br>
  Harga: Rp ${price.toLocaleString("id-ID")}<br>
  Diskon: ${disc}%<br>
  <b>Total: Rp ${total.toLocaleString("id-ID")}</b>`;
  confirmBox.classList.remove("hidden");
}

/* ORDER */
function confirmOrder(){
  const orderId="RHF-"+Date.now()+"-"+Math.floor(Math.random()*9999);
  let price=selectedItem.price;
  let disc=activeVoucher?activeVoucher.disc:0;
  let total=Math.floor(price-(price*disc/100));

  ordersRef.push({
    orderId,
    user:currentUser,
    item:selectedItem.name,
    price,disc,total,
    voucher:activeVoucher?activeVoucher.code:null,
    time:new Date().toLocaleString()
  });

  logsRef.push({
    user:currentUser,
    action:"ORDER",
    detail:orderId,
    time:new Date().toLocaleString()
  });

  const wa=`https://wa.me/6285135993982?text=`+
  encodeURIComponent(
`ORDER RHF
ID:${orderId}
User:${currentUser}
Item:${selectedItem.name}
Total:Rp ${total}`
  );
  window.open(wa,"_blank");
}
</script>

</body>
</html>
