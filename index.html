<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RHF Game Store</title>
<style>
body{background:#020617;color:#fff;font-family:Arial;margin:0;padding:16px}
.card{background:#020617;border:1px solid #1e293b;border-radius:16px;padding:16px;margin-bottom:16px}
input,button{width:100%;padding:12px;border-radius:10px;border:none;margin-top:10px}
button{background:#22c55e;color:#000;font-weight:bold}
small{color:#94a3b8}
.hidden{display:none}
</style>
</head>
<body>

<h2>RHF GAME STORE</h2>

<!-- LOGIN -->
<div class="card" id="loginBox">
<h3>Login Member</h3>
<input id="luser" placeholder="Username">
<input id="lpass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<small id="loginMsg"></small>
</div>

<!-- STORE -->
<div class="card hidden" id="store">
<h3>Gunakan Voucher</h3>
<input id="vcode" placeholder="Kode Voucher">
<button onclick="applyVoucher()">Pakai Voucher</button>
<small id="vinfo"></small>

<hr>

<h3>VIP + LUCK</h3>
<p>Harga: <b id="price">Rp 50.000</b></p>
<p>Total: <b id="final">Rp 50.000</b></p>
<button onclick="order()">Beli</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
 apiKey: "AIzaSyAyHSaALeuwibcF22VNL_6WDlcZepcDB3A",
 authDomain: "rhf-gamestore.firebaseapp.com",
 databaseURL: "https://rhf-gamestore-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId: "rhf-gamestore",
 appId: "1:52065906934:web:c15f0eff91cc937f787cd7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUser=null;
let basePrice=50000;
let discount=0;
let usedVoucher=null;

function rupiah(n){return 'Rp '+n.toLocaleString('id-ID');}

function login(){
 const u=luser.value;
 const p=lpass.value;
 db.ref('users/'+u).once('value',s=>{
  if(!s.exists()) return loginMsg.innerText='User tidak ada';
  const d=s.val();
  if(d.pass!==p) return loginMsg.innerText='Password salah';
  if(d.status!=='aktif') return loginMsg.innerText='Akun dibanned';
  currentUser=u;
  loginBox.classList.add('hidden');
  store.classList.remove('hidden');
 });
}

function applyVoucher(){
 db.ref('vouchers/'+vcode.value).once('value',s=>{
  if(!s.exists()) return vinfo.innerText='Voucher tidak valid';
  const v=s.val();
  if(!v.active||v.used>=v.max) return vinfo.innerText='Voucher habis';
  discount=v.disc;
  usedVoucher=v.code;
  updatePrice();
  vinfo.innerText='Voucher aktif: diskon '+discount+'%';
 });
}

function updatePrice(){
 const finalP = basePrice - (basePrice*discount/100);
 final.innerText=rupiah(finalP);
}

function order(){
 const finalP = basePrice - (basePrice*discount/100);
 const orderId='RHF-'+Date.now()+'-'+Math.floor(Math.random()*9999);

 db.ref('orders').push({
  orderId,
  user:currentUser,
  item:'VIP + LUCK',
  price:basePrice,
  disc:discount,
  finalPrice:finalP,
  voucher:usedVoucher,
  time:new Date().toLocaleString('id-ID')
 });

 if(usedVoucher){
  db.ref('vouchers/'+usedVoucher+'/used').transaction(n=>(n||0)+1);
 }

 window.location.href='https://wa.me/6285135993982?text='+encodeURIComponent(
  `ORDER ${orderId}\nUSER:${currentUser}\nTOTAL:${rupiah(finalP)}`
 );
}
</script>
</body>
</html>
