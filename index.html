<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RHF Game Store</title>

<style>
body{
  margin:0;
  background:linear-gradient(180deg,#020617,#000);
  color:#fff;
  font-family:Arial;
}
header{
  padding:20px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}
.box{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:18px;
  padding:16px;
  margin:16px;
}
input,button{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  margin-top:10px;
  font-size:15px;
}
button{font-weight:bold;cursor:pointer}
.green{background:#22c55e;color:#000}
.blue{background:#38bdf8;color:#000}
.gray{background:#334155;color:#fff}
.hidden{display:none}

/* GRID ITEM */
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:14px;
}
.card{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:18px;
  overflow:hidden;
}
.card img{
  width:100%;
  height:130px;
  object-fit:cover;
}
.card .info{
  padding:10px;
}
.card .info b{display:block}
.card .info small{color:#94a3b8}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(2,6,23,.88);
  backdrop-filter:blur(10px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.modal-box{
  background:#020617;
  border:1px solid #1e293b;
  border-radius:20px;
  width:92%;
  max-width:420px;
  padding:18px;
  animation:pop .25s ease;
}
@keyframes pop{
  from{transform:scale(.9);opacity:0}
  to{transform:scale(1);opacity:1}
}
.modal-box img{
  width:100%;
  height:160px;
  object-fit:cover;
  border-radius:14px;
}
</style>
</head>

<body>

<header>üéÆ RHF GAME STORE</header>

<!-- LOGIN -->
<div class="box" id="loginBox">
  <h3>üîê Login</h3>
  <input id="luser" placeholder="Username">
  <input id="lpass" placeholder="Password" type="password">
  <button class="green" onclick="login()">LOGIN</button>
  <button class="gray" onclick="regWA()">Daftar via WhatsApp</button>
</div>

<!-- EVENT -->
<div class="box hidden" id="eventBox">
  <h3>üì¢ INFO & EVENT</h3>
  <div id="events"></div>
</div>

<!-- VOUCHER -->
<div class="box hidden" id="voucherBox">
  <h3>üéüÔ∏è Voucher</h3>
  <input id="voucherInput" placeholder="Kode voucher">
  <button class="blue" onclick="useVoucher()">Pakai Voucher</button>
  <small id="voucherInfo"></small>
</div>

<!-- ITEM -->
<div class="box hidden" id="itemBox">
  <h3>üõí Produk</h3>
  <div class="grid" id="items"></div>
</div>

<!-- MODAL ITEM -->
<div class="modal hidden" id="itemModal">
  <div class="modal-box">
    <img id="mImg">
    <h3 id="mName"></h3>
    <small id="mDesc"></small><br><br>
    <b id="mPrice"></b><br><br>
    <button class="green" onclick="confirmOrder()">BELI</button>
    <button class="gray" onclick="closeModal()">TUTUP</button>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyAyHSaALeuwibcF22VNL_6WDlcZepcDB3A",
 authDomain:"rhf-gamestore.firebaseapp.com",
 databaseURL:"https://rhf-gamestore-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId:"rhf-gamestore"
});

const db=firebase.database();
const usersRef=db.ref("users");
const itemsRef=db.ref("items");
const vouchersRef=db.ref("vouchers");
const ordersRef=db.ref("orders");
const eventsRef=db.ref("events");

let currentUser=null;
let activeVoucher=null;
let selectedItem=null;

/* LOGIN */
function login(){
 usersRef.child(luser.value).once("value",s=>{
  if(!s.exists())return alert("User tidak ada");
  const d=s.val();
  if(d.pass!==lpass.value)return alert("Password salah");
  if(d.status!=="aktif")return alert("Akun diblokir");

  currentUser=d.user;
  loginBox.classList.add("hidden");
  itemBox.classList.remove("hidden");
  voucherBox.classList.remove("hidden");
  eventBox.classList.remove("hidden");
 });
}

function regWA(){
 window.open("https://wa.me/6285135993982?text=DAFTAR%20AKUN%20RHF","_blank");
}

/* EVENT */
eventsRef.limitToLast(5).on("value",s=>{
 events.innerHTML="";
 s.forEach(c=>{
  const d=c.val();
  events.innerHTML+=`<div>üìå <b>${d.title}</b><br>${d.msg}</div><hr>`;
 });
});

/* ITEM */
itemsRef.on("value",s=>{
 items.innerHTML="";
 s.forEach(c=>{
  const d=c.val();
  items.innerHTML+=`
   <div class="card" onclick='openItem(${JSON.stringify(d)})'>
    <img src="${d.img}">
    <div class="info">
     <b>${d.name}</b>
     <small>Rp ${d.price.toLocaleString("id-ID")}</small>
    </div>
   </div>`;
 });
});

function openItem(d){
 selectedItem=d;
 mImg.src=d.img;
 mName.innerText=d.name;
 mDesc.innerText=d.desc||"Deskripsi tidak tersedia";
 mPrice.innerText="Rp "+calcPrice(d.price).toLocaleString("id-ID");
 itemModal.classList.remove("hidden");
 document.body.style.overflow="hidden";
}

function closeModal(){
 itemModal.classList.add("hidden");
 document.body.style.overflow="auto";
}

/* VOUCHER */
function useVoucher(){
 vouchersRef.child(voucherInput.value).once("value",s=>{
  if(!s.exists())return alert("Voucher salah");
  const d=s.val();
  if(!d.active||d.used>=d.max)return alert("Voucher tidak aktif");

  activeVoucher=d;
  voucherInfo.innerText="Diskon "+d.disc+"% aktif";
 });
}

function calcPrice(price){
 return activeVoucher ? Math.floor(price-(price*activeVoucher.disc/100)) : price;
}

/* ORDER */
function confirmOrder(){
 const id="RHF-"+Date.now()+"-"+Math.floor(Math.random()*9999);
 const total=calcPrice(selectedItem.price);

 ordersRef.push({
  orderId:id,
  user:currentUser,
  item:selectedItem.name,
  price:selectedItem.price,
  disc:activeVoucher?activeVoucher.disc:0,
  total,
  voucher:activeVoucher?activeVoucher.code:null,
  time:new Date().toLocaleString()
 });

 if(activeVoucher){
  vouchersRef.child(activeVoucher.code)
   .update({used:firebase.database.ServerValue.increment(1)});
 }

 window.open(
  "https://wa.me/6285135993982?text="+
  encodeURIComponent(
   `ORDER RHF\nID:${id}\nUser:${currentUser}\nItem:${selectedItem.name}\nTotal:Rp ${total}`
  )
 ,"_blank");

 closeModal();
}
</script>

</body>
</html>
