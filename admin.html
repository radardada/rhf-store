<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - RHF GAMES</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="style.css">
  <script src="utils.js"></script>

  <style>
    body {
      background: #0e0e11;
      color: #fff;
      font-family: Arial, sans-serif;
    }
    .admin-container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      color: #00ffd5;
    }
    .card {
      background: #16161d;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 10px;
      border-radius: 6px;
      border: none;
      margin: 5px 0;
    }
    button {
      background: #00ffd5;
      cursor: pointer;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #333;
    }
    .danger {
      background: #ff3b3b;
      color: white;
    }
  </style>
</head>

<body onload="initAdmin()">

<div class="admin-container">

  <h1>üéõÔ∏è ADMIN PANEL ‚Äî RHF GAMES</h1>

  <!-- ================= LOGIN ================= -->
  <div class="card" id="loginBox">
    <h3>üîê Login Admin</h3>
    <input type="password" id="adminPass" placeholder="Password admin">
    <button onclick="loginAdmin()">Login</button>
  </div>

  <!-- ================= DASHBOARD ================= -->
  <div id="adminPanel" style="display:none;">

    <!-- MARKUP -->
    <div class="card">
      <h3>üí∞ Pengaturan Markup Harga</h3>
      <p>Harga Asli + Markup = Harga Jual</p>
      <input type="number" id="markupInput" placeholder="Contoh: 1000">
      <button onclick="saveMarkup()">Simpan Markup</button>
    </div>

    <!-- PRODUK -->
    <div class="card">
      <h3>üéÆ Manajemen Produk</h3>

      <input type="text" id="productName" placeholder="Nama Produk">
      <input type="number" id="basePrice" placeholder="Harga Asli">
      <select id="productCategory">
        <option value="GAME">Game</option>
        <option value="E-WALLET">E-Wallet</option>
        <option value="VOUCHER">Voucher</option>
        <option value="PULSA">Pulsa & Data</option>
      </select>

      <button onclick="addProduct()">Tambah Produk</button>

      <table>
        <thead>
          <tr>
            <th>Produk</th>
            <th>Harga Asli</th>
            <th>Harga Jual</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="productTable"></tbody>
      </table>
    </div>

    <!-- ORDER -->
    <div class="card">
      <h3>üì¶ Pesanan Masuk</h3>
      <table>
        <thead>
          <tr>
            <th>Invoice</th>
            <th>Produk</th>
            <th>User Input</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="orderTable"></tbody>
      </table>
    </div>

    <button class="danger" onclick="logoutAdmin()">Logout</button>

  </div>

</div>

<script>
/* ================= LOGIN ================= */
function initAdmin() {
  if (isAdmin()) {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
    loadMarkup();
    loadProducts();
    loadOrders();
  }
}

function loginAdmin() {
  const pass = document.getElementById("adminPass").value;
  if (pass === "admin123") {
    localStorage.setItem("rhf_admin_login", "true");
    location.reload();
  } else {
    alert("Password salah");
  }
}

function logoutAdmin() {
  localStorage.removeItem("rhf_admin_login");
  location.reload();
}

/* ================= MARKUP ================= */
function loadMarkup() {
  const cfg = getAdminConfig();
  document.getElementById("markupInput").value = cfg.markup;
}

function saveMarkup() {
  const value = document.getElementById("markupInput").value;
  setAdminConfig({ markup: parseInt(value) });
  alert("Markup berhasil disimpan");
  loadProducts();
}

/* ================= PRODUK ================= */
function getProducts() {
  return JSON.parse(localStorage.getItem("rhf_products")) || [];
}

function saveProducts(data) {
  localStorage.setItem("rhf_products", JSON.stringify(data));
}

function addProduct() {
  const name = productName.value;
  const base = basePrice.value;
  const cat = productCategory.value;

  if (!name || !base) return alert("Lengkapi data");

  const products = getProducts();
  products.push({
    id: Date.now(),
    name,
    basePrice: base,
    category: cat,
  });

  saveProducts(products);
  loadProducts();
}

function loadProducts() {
  const tbody = document.getElementById("productTable");
  tbody.innerHTML = "";

  getProducts().forEach((p, i) => {
    const sell = getSellPrice(p.basePrice);
    tbody.innerHTML += `
      <tr>
        <td>${p.name}</td>
        <td>${formatRupiah(p.basePrice)}</td>
        <td>${formatRupiah(sell)}</td>
        <td>
          <button class="danger" onclick="deleteProduct(${i})">Hapus</button>
        </td>
      </tr>`;
  });
}

function deleteProduct(index) {
  const products = getProducts();
  products.splice(index, 1);
  saveProducts(products);
  loadProducts();
}

/* ================= ORDER ================= */
function loadOrders() {
  const orders = JSON.parse(localStorage.getItem("rhf_orders")) || [];
  const tbody = document.getElementById("orderTable");
  tbody.innerHTML = "";

  orders.forEach(o => {
    tbody.innerHTML += `
      <tr>
        <td>${o.invoice}</td>
        <td>${o.product}</td>
        <td>${o.userInput}</td>
        <td>${formatRupiah(o.total)}</td>
      </tr>`;
  });
}
</script>

</body>
</html>
