<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Panel — RHF Game Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#0b0f1a;
  color:#fff;
  font-family:Arial;
  margin:0;
  padding:20px;
}
h1,h2{margin-top:0}
.box{
  background:#11162a;
  padding:15px;
  border-radius:12px;
  margin-bottom:20px;
}
input,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:none;
}
button{
  padding:10px 15px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}
.green{background:#2ecc71;color:#000}
.red{background:#e74c3c;color:#fff}
.gray{background:#bdc3c7;color:#000}
.item{
  border:1px solid #333;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
}
small{opacity:.7}
</style>
</head>

<body>

<h1>Admin Panel — RHF</h1>

<!-- ================= AKUN ================= -->
<div class="box">
<h2>Buat Akun Pembeli</h2>
<input id="user" placeholder="Username">
<input id="pass" placeholder="Password">
<button class="green" onclick="saveUser()">SIMPAN AKUN</button>
<button class="gray" onclick="showUsers()">LIHAT AKUN</button>
</div>

<div class="box" id="userBox" style="display:none">
<h2>Daftar Akun</h2>
<div id="userList"></div>
<button class="red" onclick="closeUsers()">TUTUP</button>
</div>

<!-- ================= VOUCHER ================= -->
<div class="box">
<h2>Buat Voucher</h2>
<input id="vcode" placeholder="Kode Voucher">
<input id="vdiscount" type="number" placeholder="Potongan (%)">
<input id="vmax" type="number" placeholder="Maksimal Pemakai">
<input id="vexp" type="date">
<button class="green" onclick="createVoucher()">BUAT VOUCHER</button>
</div>

<div class="box">
<h2>Daftar Voucher</h2>
<div id="voucherList"></div>
</div>

<!-- ================= FIREBASE ================= -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "API_KEY_KAMU",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT.firebaseio.com",
  projectId: "PROJECT"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= USER ================= */

function saveUser(){
  const u = user.value.trim();
  const p = pass.value.trim();
  if(!u||!p) return alert("Lengkapi data");

  db.ref("users/"+u).set({
    user:u,
    pass:p,
    status:"active"
  }).then(()=>{
    alert("Akun tersimpan");
    user.value="";
    pass.value="";
  });
}

function showUsers(){
  userBox.style.display="block";
  loadUsers();
}

function closeUsers(){
  userBox.style.display="none";
}

function loadUsers(){
  userList.innerHTML="Memuat...";
  db.ref("users").once("value",snap=>{
    userList.innerHTML="";
    if(!snap.exists()){
      userList.innerHTML="<small>Belum ada akun</small>";
      return;
    }
    snap.forEach(s=>{
      const u=s.val();
      userList.innerHTML+=`
        <div class="item">
          <b>${u.user}</b><br>
          Status: ${u.status}<br><br>
          <button onclick="toggleUser('${u.user}','${u.status}')">
            ${u.status==="active"?"NONAKTIFKAN":"AKTIFKAN"}
          </button>
        </div>`;
    });
  });
}

function toggleUser(u,st){
  db.ref("users/"+u+"/status").set(
    st==="active"?"blocked":"active"
  ).then(loadUsers);
}

/* ================= VOUCHER ================= */

function createVoucher(){
  const c=vcode.value.trim();
  const d=parseInt(vdiscount.value);
  const m=parseInt(vmax.value);
  const e=vexp.value;

  if(!c||!d||!m||!e) return alert("Lengkapi data");

  db.ref("vouchers/"+c).set({
    code:c,
    discount:d,
    max:m,
    used:0,
    expire:e,
    users:{}
  }).then(()=>{
    alert("Voucher dibuat");
    vcode.value="";
    vdiscount.value="";
    vmax.value="";
    loadVouchers();
  });
}

function loadVouchers(){
  voucherList.innerHTML="Memuat...";
  db.ref("vouchers").on("value",snap=>{
    voucherList.innerHTML="";
    if(!snap.exists()){
      voucherList.innerHTML="<small>Tidak ada voucher</small>";
      return;
    }
    snap.forEach(s=>{
      const v=s.val();
      voucherList.innerHTML+=`
        <div class="item">
          <b>${v.code}</b><br>
          Potongan: ${v.discount}%<br>
          Digunakan: ${v.used}/${v.max}<br>
          Exp: ${v.expire}
        </div>`;
    });
  });
}
loadVouchers();
</script>

</body>
</html>
