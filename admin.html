<!doctype html>

<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RHF Admin Control</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"><script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, update, push } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

// ================= FIREBASE CONFIG =================
const firebaseConfig = {
  apiKey: "AIzaSyAyHSaALeuwibcF22VNL_6WDlcZepcDB3A",
  authDomain: "rhf-gamestore.firebaseapp.com",
  databaseURL: "https://rhf-gamestore-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rhf-gamestore",
  storageBucket: "rhf-gamestore.firebasestorage.app",
  messagingSenderId: "52065906934",
  appId: "1:52065906934:web:c15f0eff91cc937f787cd7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let selectedUser = null;

// ================= LOAD TOPUP =================
onValue(ref(db,'topup'), snap => {
  const box = document.getElementById('topupList');
  box.innerHTML='';
  snap.forEach(c=>{
    const t=c.val();
    if(t.status!=='pending') return;
    box.innerHTML += `
      <div class="card">
        <b>${t.username}</b><br>
        Jumlah: Rp ${t.jumlah}<br>
        <a href="${t.bukti}" target="_blank">Lihat Bukti</a><br><br>
        <button onclick="confirmTopup('${c.key}','${t.userId}',${t.jumlah})">Konfirmasi</button>
        <button class="danger" onclick="rejectTopup('${c.key}')">Tolak</button>
      </div>`;
  });
});

window.confirmTopup = (id,user,amt)=>{
  update(ref(db,'users/'+user),{ saldoIncrement: amt });
  update(ref(db,'topup/'+id),{ status:'berhasil' });
  alert('Top up dikonfirmasi');
};

window.rejectTopup = (id)=>{
  update(ref(db,'topup/'+id),{ status:'ditolak' });
};

// ================= LOAD CS USER LIST =================
onValue(ref(db,'cs'), snap => {
  const list=document.getElementById('userList');
  list.innerHTML='';
  snap.forEach(c=>{
    list.innerHTML+=`<div class="user" onclick="openChat('${c.key}')">${c.key}</div>`;
  });
});

window.openChat = (uid)=>{
  selectedUser=uid;
  const box=document.getElementById('chat');
  onValue(ref(db,'cs/'+uid+'/messages'), snap=>{
    box.innerHTML='';
    snap.forEach(c=>{
      const m=c.val();
      const b=document.createElement('div');
      b.className='bubble '+(m.from==='admin'?'right':'left');
      b.innerText=m.text;
      box.appendChild(b);
    });
    box.scrollTop=box.scrollHeight;
  });
};

window.sendAdmin = ()=>{
  const t=document.getElementById('adminText').value.trim();
  if(!t||!selectedUser) return;
  push(ref(db,'cs/'+selectedUser+'/messages'),{ from:'admin', text:t, time:Date.now() });
  document.getElementById('adminText').value='';
};
</script><style>
*{box-sizing:border-box;font-family:Roboto}
body{margin:0;background:#0f1115;color:#fff}
header{background:#151821;padding:14px;font-size:18px;font-weight:700}
.container{display:flex;height:calc(100vh - 50px)}
.sidebar{width:220px;background:#151821;overflow:auto}
.user{padding:12px;border-bottom:1px solid #222;cursor:pointer}
.user:hover{background:#1b1f2a}
.main{flex:1;display:flex;flex-direction:column}
.card{background:#1b1f2a;padding:12px;border-radius:12px;margin-bottom:10px}
button{padding:8px 12px;border:none;border-radius:8px;background:#4cafef;font-weight:700;margin-right:6px}
.danger{background:#f44336;color:#fff}
#chat{flex:1;overflow:auto;padding:10px}
.bubble{max-width:70%;padding:8px 12px;border-radius:14px;margin:6px 0}
.left{background:#2a2f3a}
.right{background:#4cafef;color:#000;margin-left:auto}
.input{display:flex;padding:10px;gap:8px}
.input input{flex:1;padding:10px;border-radius:10px;border:none}
</style></head>
<body>
<header>RHF Admin Control</header><div class="container">
  <!-- SIDEBAR -->
  <div class="sidebar">
    <div class="user" onclick="document.getElementById('sectionTopup').scrollIntoView()">ðŸ’° Top Up Pending</div>
    <div class="user" onclick="document.getElementById('sectionCS').scrollIntoView()">ðŸ’¬ CS User</div>
  </div>  <!-- MAIN -->  <div class="main">
    <!-- TOPUP -->
    <div id="sectionTopup" style="padding:14px">
      <h3>Top Up Pending</h3>
      <div id="topupList"></div>
    </div><!-- CS -->
<div id="sectionCS" style="padding:14px;flex:1;display:flex">
  <div style="width:200px;background:#151821;margin-right:10px" id="userList"></div>
  <div style="flex:1;display:flex;flex-direction:column">
    <div id="chat"></div>
    <div class="input">
      <input id="adminText" placeholder="Balas pesan...">
      <button onclick="sendAdmin()">Kirim</button>
    </div>
  </div>
</div>

  </div>
</div></body>
</html>
