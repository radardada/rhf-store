<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel | RHF Store</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Admin Dashboard</h1>
    <button onclick="logout()">Logout</button>
  </header>

  <section>
    <h2>Tambah/Edit Produk</h2>
    <form id="product-form">
      <input id="prod-name" placeholder="Nama Produk (misal Server VPS 1GB)">
      <input id="prod-price" type="number" placeholder="Harga (Rp)">
      <textarea id="prod-desc" placeholder="Deskripsi (misal Akses SSH, 1 bulan)"></textarea>
      <input id="prod-image" placeholder="URL Gambar">
      <button type="submit">Tambah Produk</button>
    </form>

    <h2>Daftar Produk</h2>
    <table class="admin-table" id="products-table">
      <tr><th>ID</th><th>Nama</th><th>Harga</th><th>Aksi</th></tr>
    </table>
  </section>

  <section>
    <h2>Daftar Pembeli/Orders</h2>
    <table class="admin-table" id="orders-table">
      <tr><th>ID Order</th><th>User ID</th><th>Produk</th><th>Waktu</th></tr>
    </table>
  </section>

  <section>
    <h2>Daftar User yang Login</h2>
    <table class="admin-table" id="users-table">
      <tr><th>User ID</th><th>Email</th><th>Last Login</th></tr>
    </table>
  </section>

  <script type="module">
    import { logout, checkAuth } from './auth.js';
    import { fetchProducts, addProduct, deleteProduct, fetchOrders, fetchUsers } from './utils.js';

    checkAuth((user) => {
      if (!user || user.email !== 'admin@rhfgamestore.com') {
        alert('Akses ditolak!');
        window.location.href = 'index.html';
      }
    });

    async function loadAdminData() {
      // Load Produk
      const products = await fetchProducts();
      const prodTable = document.getElementById('products-table');
      for (let id in products) {
        const row = `<tr><td>\( {id}</td><td> \){products[id].name}</td><td>\( {formatRupiah(products[id].price)}</td><td><button onclick="deleteProd(' \){id}')">Hapus</button></td></tr>`;
        prodTable.innerHTML += row;
      }

      // Load Orders
      const orders = await fetchOrders();
      const orderTable = document.getElementById('orders-table');
      for (let id in orders) {
        const ord = orders[id];
        const row = `<tr><td>\( {id}</td><td> \){ord.userId}</td><td>\( {ord.productId}</td><td> \){ord.timestamp}</td></tr>`;
        orderTable.innerHTML += row;
      }

      // Load Users
      const users = await fetchUsers();
      const userTable = document.getElementById('users-table');
      for (let id in users) {
        const usr = users[id];
        const row = `<tr><td>\( {id}</td><td> \){usr.email}</td><td>${usr.lastLogin}</td></tr>`;
        userTable.innerHTML += row;
      }
    }
    loadAdminData();

    document.getElementById('product-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const product = {
        name: document.getElementById('prod-name').value,
        price: parseInt(document.getElementById('prod-price').value),
        description: document.getElementById('prod-desc').value,
        image: document.getElementById('prod-image').value
      };
      await addProduct(product);
      location.reload();
    });

    window.deleteProd = async (id) => {
      await deleteProduct(id);
      location.reload();
    };
  </script>
</body>
</html>
