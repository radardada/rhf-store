<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Dashboard | RHF Store</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">
  <div class="d-flex">
    <!-- Sidebar -->
    <div class="sidebar p-4">
      <h4 class="text-center text-white mb-4">Admin Panel</h4>
      <a href="#section-products" class="text-white">Produk</a>
      <a href="#section-orders" class="text-white">Orders</a>
      <a href="#section-users" class="text-white">Users</a>
      <a href="index.html" class="text-white" onclick="logout()">Logout</a>
    </div>

    <!-- Main Content -->
    <div class="flex-grow-1 p-5">
      <h1 class="mb-5">Dashboard Admin</h1>

      <!-- Section Tambah Produk -->
      <div id="section-products" class="card mb-5">
        <div class="card-header bg-primary text-white">
          <h3>Tambah Produk Baru</h3>
        </div>
        <div class="card-body">
          <form id="product-form" class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nama Produk</label>
              <input type="text" id="prod-name" class="form-control" placeholder="Contoh: Server VPS 1GB RAM" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Harga (Rp)</label>
              <input type="number" id="prod-price" class="form-control" placeholder="50000" required>
            </div>
            <div class="col-12">
              <label class="form-label">Deskripsi</label>
              <textarea id="prod-desc" class="form-control" rows="4" placeholder="Detail produk, misal: Akses full root, 1 bulan"></textarea>
            </div>
            <div class="col-12">
              <label class="form-label">URL Gambar</label>
              <input type="url" id="prod-image" class="form-control" placeholder="https://example.com/image.jpg">
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-success btn-lg">Tambah Produk</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Daftar Produk -->
      <div class="card mb-5">
        <div class="card-header bg-primary text-white">
          <h3>Daftar Produk</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="products-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nama</th>
                  <th>Harga</th>
                  <th>Deskripsi</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody>
                <!-- Data dimuat via JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Daftar Orders -->
      <div id="section-orders" class="card mb-5">
        <div class="card-header bg-primary text-white">
          <h3>Daftar Orders / Pembeli</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped" id="orders-table">
              <thead>
                <tr><th>ID Order</th><th>User ID</th><th>Produk ID</th><th>Waktu</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Daftar Users -->
      <div id="section-users" class="card">
        <div class="card-header bg-primary text-white">
          <h3>Daftar User yang Login</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped" id="users-table">
              <thead>
                <tr><th>User ID</th><th>Email</th><th>Last Login</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module">
    import { logout, checkAuth } from './auth.js';
    import { fetchProducts, addProduct, deleteProduct, fetchOrders, fetchUsers } from './utils.js';

    // Fungsi format Rupiah (jika belum ada di utils.js)
    function formatRupiah(angka) {
      return 'Rp ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    // Proteksi akses admin
    checkAuth((user) => {
      if (!user || user.email !== 'admin@rhfgamestore.com') { // Ganti dengan email admin mu
        alert('Akses ditolak! Login sebagai admin dulu.');
        window.location.href = 'index.html';
      }
    });

    // Load semua data
    async function loadAdminData() {
      const products = await fetchProducts();
      const prodBody = document.querySelector('#products-table tbody');
      prodBody.innerHTML = '';
      for (let id in products) {
        const prod = products[id];
        prodBody.innerHTML += `
          <tr>
            <td>${id}</td>
            <td>${prod.name}</td>
            <td>${formatRupiah(prod.price)}</td>
            <td>${prod.description || '-'}</td>
            <td><button class="btn btn-danger btn-sm" onclick="deleteProd('${id}')">Hapus</button></td>
          </tr>`;
      }

      const orders = await fetchOrders();
      const orderBody = document.querySelector('#orders-table tbody');
      orderBody.innerHTML = '';
      for (let id in orders) {
        const ord = orders[id];
        orderBody.innerHTML += `<tr><td>\( {id}</td><td> \){ord.userId}</td><td>\( {ord.productId}</td><td> \){ord.timestamp}</td></tr>`;
      }

      const users = await fetchUsers();
      const userBody = document.querySelector('#users-table tbody');
      userBody.innerHTML = '';
      for (let id in users) {
        const usr = users[id];
        userBody.innerHTML += `<tr><td>\( {id}</td><td> \){usr.email}</td><td>${usr.lastLogin}</td></tr>`;
      }
    }
    loadAdminData();

    // Handle tambah produk
    document.getElementById('product-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const product = {
        name: document.getElementById('prod-name').value,
        price: parseInt(document.getElementById('prod-price').value),
        description: document.getElementById('prod-desc').value,
        image: document.getElementById('prod-image').value || 'https://via.placeholder.com/300'
      };
      await addProduct(product);
      alert('Produk berhasil ditambahkan!');
      document.getElementById('product-form').reset();
      loadAdminData(); // Refresh table
    });

    // Hapus produk
    window.deleteProd = async (id) => {
      if (confirm('Yakin hapus produk ini?')) {
        await deleteProduct(id);
        loadAdminData();
      }
    };
  </script>
</body>
    </html>
import { db } from './firebase.js';
import { ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const testProduct = {
  name: "Test VPS 1GB",
  price: 50000,
  description: "Test produk dari console",
  image: "https://via.placeholder.com/300"
};

const newRef = push(ref(db, 'products'));
set(newRef, testProduct).then(() => {
  console.log("Berhasil ditambah!");
}).catch((err) => {
  console.error("Gagal:", err);
});
