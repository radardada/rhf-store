<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keranjang Belanja - RHF GAMES</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #f0f2f5; font-family: 'Poppins', sans-serif; }
        .container { max-width: 1200px; margin: 40px auto; padding: 20px; display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
        
        .cart-items { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .item { display: flex; align-items: center; padding: 20px 0; border-bottom: 1px solid #eee; }
        .item img { width: 100px; height: 100px; object-fit: cover; border-radius: 10px; margin-right: 20px; }
        .item-info { flex: 1; }
        .item-info h3 { margin: 0; font-size: 18px; }
        .item-price { font-size: 22px; font-weight: bold; color: #00aa5b; }
        .remove-btn { background: #ff4d4f; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }
        
        .summary { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); position: sticky; top: 100px; height: fit-content; }
        .summary h2 { margin-top: 0; color: #333; }
        .total-row { display: flex; justify-content: space-between; font-size: 20px; margin: 20px 0; }
        .grand-total { font-size: 28px; font-weight: bold; color: #00aa5b; border-top: 2px solid #eee; padding-top: 20px; }
        .checkout-btn { width: 100%; background: #00aa5b; color: white; padding: 18px; font-size: 20px; border: none; border-radius: 12px; cursor: pointer; margin-top: 20px; }
        .checkout-btn:hover { background: #008c47; }
        
        .empty-cart { text-align: center; padding: 80px 20px; }
        .empty-cart img { max-width: 400px; width: 100%; margin-bottom: 30px; }
        .empty-cart h2 { color: #999; }
        .empty-cart a { color: #00aa5b; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div class="container" id="mainContent" style="display:none;">
    <div class="cart-items" id="cartItemsList">
        <!-- Item keranjang akan muncul di sini -->
    </div>

    <div class="summary">
        <h2>Ringkasan Belanja</h2>
        <div class="total-row"><span>Subtotal</span><span id="subtotal">Rp 0</span></div>
        <div class="total-row grand-total"><span>Total</span><span id="grandTotal">Rp 0</span></div>
        <button class="checkout-btn" onclick="alert('Fitur pembayaran segera hadir! (Integrasi Midtrans nanti)')">
            Lanjutkan Pembayaran
        </button>
    </div>
</div>

<div class="empty-cart" id="emptyCart">
    <img src="https://cdni.iconscout.com/illustration/premium/thumb/empty-cart-illustration-svg-download-png-2902552.png" alt="Keranjang Kosong">
    <h2>Keranjang belanja kamu masih kosong nih!</h2>
    <p>Yuk cari game favoritmu dulu <a href="game.html">di sini â†’</a></p>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script src="firebase.js"></script>
<script src="auth.js"></script>

<script>
// Cek login dulu
auth.onAuthStateChanged(user => {
    if (!user) {
        alert("Login dulu ya untuk lihat keranjang!");
        window.location.href = "index.html";
        return;
    }

    // Load keranjang real-time
    const cartRef = db.collection("carts").doc(user.uid);
    const cartList = document.getElementById("cartItemsList");
    let total = 0;

    cartRef.onSnapshot(doc => {
        cartList.innerHTML = "";
        total = 0;

        if (!doc.exists || Object.keys(doc.data()).length === 0) {
            document.getElementById("mainContent").style.display = "none";
            document.getElementById("emptyCart").style.display = "block";
            return;
        }

        document.getElementById("mainContent").style.display = "grid";
        document.getElementById("emptyCart").style.display = "none";

        const data = doc.data();
        Object.keys(data).forEach(gameId => {
            const item = data[gameId];
            total += item.price;

            const div = document.createElement("div");
            div.className = "item";
            div.innerHTML = `
                <img src="\( {item.image}" alt=" \){item.title}">
                <div class="item-info">
                    <h3>${item.title}</h3>
                    <p>Kategori: ${item.category || "Game"}</p>
                </div>
                <div class="item-price">Rp ${item.price.toLocaleString("id-ID")}</div>
                <button class="remove-btn" onclick="removeFromCart('${gameId}')">Hapus</button>
            `;
            cartList.appendChild(div);
        });

        document.getElementById("subtotal").textContent = "Rp " + total.toLocaleString("id-ID");
        document.getElementById("grandTotal").textContent = "Rp " + total.toLocaleString("id-ID");
    });
});

// Hapus dari keranjang
function removeFromCart(gameId) {
    const user = auth.currentUser;
    if (user && confirm("Hapus game ini dari keranjang?")) {
        db.collection("carts").doc(user.uid).update({
            [gameId]: firebase.firestore.FieldValue.delete()
        });
    }
}
</script>

</body>
</html>
