<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - RHF GAMES</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Checkout</h1>
        <div id="cartItems"></div>
        <h2>Total: <span id="totalPrice">Rp 0</span></h2>
        <button class="checkout-btn" id="payBtn">Bayar Sekarang</button>
    </div>

    <script src="https://app.sandbox.midtrans.com/snap/snap.js" data-client-key="YOUR_MIDTRANS_CLIENT_KEY"></script> <!-- Ganti dengan Client Key Midtrans kamu -->

    <script src="firebase.js"></script>
    <script src="auth.js"></script>
    <script src="utils.js"></script>

    <script>
        auth.onAuthStateChanged(user => {
            if (!user) {
                showToast("Login dulu untuk checkout!", 'error');
                location.href = 'index.html';
                return;
            }

            const cartRef = db.collection('carts').doc(user.uid);
            const cartItems = document.getElementById('cartItems');
            const totalPrice = document.getElementById('totalPrice');
            let total = 0;

            cartRef.onSnapshot(doc => {
                cartItems.innerHTML = '';
                total = 0;
                if (!doc.exists) {
                    cartItems.innerHTML = "<p>Keranjang kosong.</p>";
                    return;
                }
                const data = doc.data();
                Object.keys(data).forEach(key => {
                    const item = data[key];
                    total += item.price;
                    cartItems.innerHTML += `
                        <div class="cart-item">
                            <img src="\( {item.image}" alt=" \){item.title}">
                            <h3>${item.title}</h3>
                            <p>${item.amount}</p>
                            <p>${formatRupiah(item.price)}</p>
                            <button class="btn-danger" onclick="removeFromCart('${key}')">Hapus</button>
                        </div>
                    `;
                });
                totalPrice.textContent = formatRupiah(total);
            });

            // Bayar Otomatis pakai Midtrans
            document.getElementById('payBtn').onclick = () => {
                // Buat transaction token dari backend (kalau ada server, pakai Node.js; sekarang placeholder)
                const snapToken = 'YOUR_SNAP_TOKEN_FROM_BACKEND'; // Nanti integrasi server-side
                snap.pay(snapToken, {
                    onSuccess: (result) => {
                        showToast("Pembayaran berhasil!", 'success');
                        // Update order status di Firebase
                    },
                    onPending: (result) => {
                        showToast("Pembayaran pending", 'error');
                    },
                    onError: (result) => {
                        showToast("Pembayaran gagal", 'error');
                    }
                });
            };
        });
    </script>
</body>
</html>
